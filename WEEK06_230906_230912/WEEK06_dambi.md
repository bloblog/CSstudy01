# 3.3 프로세스와 스레드 / 3.4 CPU 스케줄링 알고리즘

날짜: 2023/09/12
태그: study
세부항목: CS스터디, SSAFY

# 3.3 프로세스와 스레드

### 3.3.1 프로세스와 컴파일 과정

- 프로세스
    - 프로그램이 메모리에 올라가 인스턴스화된 것

- 소스코드 파일 → 전처리 → 컴파일러 → (어셈블리어) → 어셈블러 → (목적 코드) → 링커 → 실행 가능한 파일

- 전처리
    - 소스 코드의 주석을 제거하고 #include 등 헤더 파일을 병합하여 매크로를 치환
- 컴파일러
    - 오류 처리, 코드 최적화 작업을 하며 어셈블리어로 변환
- 어셈블러
    - 어셈블리어 → 목적코드로 변환
- 링커
    - 실행 파일을 만든다 → 라이브러리 or 다른 파일들과 목적코드 결합
    - 정적 라이브러리 vs 동적 라이브러리
        - 정적
            
            : 프로그램 빌드 시 라이브러리가 제공하는 모든 코드를 실행 파일에 넣는 방식으로 라이브러리를 쓰는 방법
            
            - 외부 의존도가 낮음
            - 코드 중복 등 메모리 효율성이 떨어짐
        - 동적
            - DDL이라는 함수 정보를 통해 참조하여 라이브러리 쓰기
            - 메모리 효율성에서의 장점을 지니지만 외부 의존도가 높아진다는 단점

### 3.3.2 프로세스의 상태

- 생성 상태
    - 프로세스가 생성된 상태
    - fork()
        - 부모 프로세스의 주소 공간을 그대로 복사하며, 새로운 자식을 프로세스를 생성하는 함수
        - 주소 공간만 복사할 뿐, 비동기 작업 등 상속 x
    - exec()
        - exec() 새롭게 프로세스를 생성하는 함수

- 대기 상태
    - ready : 메모리 공간이 충분하면 메모리를 할당 받고 아니면 아닌 상태로 대기
    - CPU 스케줄러로부터 CPU 소유권이 넘어오기를 기다리는 상태

- 대기 중단 상태
    - 메모리 부족으로 일시 중단된 상태

- 실행 상태
    - CPU 소유권과 메모리를 할당 받고 인스트럭션을 수행 중인 상태
    - CPU burst

- 중단 상태
    - 어떤 이벤트가 발생한 후 기다리며 프로세스가 차단된 상태
    - I/O 디바이스에 의한 인터럽트로 이런 현상이 많이 발생하기도
    
- 일시 중단 상태
    - 대기 중단과 유사 → 메모리 부족으로 일시 중단

- 종료 상태
    - 메모리와 CPU 소유권을 모두 놓고 가는 상태
    - 종료는 자연스럽게 종료되는 것도 있 but 부모 프로세스가 자식 프로세스를 강제 시키는 비자발적 종료로 종료되는 것도 있음

### 3.3.3 프로세스의 메모리 구조

- 스택과 힙
    - 동적 할당됨
        - 런타임 단계에서 메모리를 할당 받는 것을 말함
    - 스택
        - 지역변수, 매개변수, 실행되는 함수에 의해 늘어나거나 줄어든느 메모리
        - 함수가 호출될 때마다 저장됨
        - 재귀마다 새로운 스택 프레임이 매번 사용됨
    - 힙
        - 동적 할당 변수
        - 동적 자료구조 → 힙 사용
- 데이터 영역과 코드 영역
    - 정적 할당되는 영역
    - 정적 할당은 컴파일 단계에서 메모리를 할당하는 것
    - BSS segment / code segment ??? ← 더 찾아볼 것

### 3.3.5 PCB

- 운영 체제에서 프로세스에 대한 메타데이터를 저장한 데이터
- 프로세스 제어 블록
    - 메타 데이터 : 데이터에 관한 구조화된 데이터이자 데이터를 설명하는 작은 데이터

- 구조
    - 프로세스 스케줄링 상태
    - 프로세스 ID
    - 프로세스 권한
    - 프로그램 카운터
    - CPU 레지스터
    - CPU 스케줄링 정보
    - 계정 정보
    - I/O 정보
    
- 컨텍스트 스위칭
    - PCB를 교환하는 과정
    - 동시 실행x, 다른 프로세스와 스위칭
    - 현대 컴퓨터 - 멀티 코어 CPU but 컨텍스트 스위칭을 설명할 때는 싱글 코어를 기준으로 설명
    
    - 캐시미스
        - 프로세스가 가지고 있는 메모리 주소가 그대로 있으면 잘못된 주소 변환 → 캐시 클리어 필요
        - 스레드 → 스택영역을 제외한 모든 메모리 공유 → 비용이 적고 시간도 적게 걸림
    

### 3.3.5 멀티프로세싱

- 웹 브라우저
    - 멀티프로세스 구조를 가지고 있음

- IPC
    - IPC는 프로세스끼리 데이터를 주고 받고 공유 데이터를 관리하는 메커니즘
    
    - 공유  메모리
        - 여러 프로세스에 동일한 메모리 블록에 대한 접근 권한 부여 → 서로 통신할 수 있도록 공유 메모리를 생성해서 통신
        - 메모리 자체를 공유하기 대문에 불필요한 데이터 복사의 오버헤드 발생 x
    - 파일
    - 소켓
        - TCP, UDP  ??/??  다시 찾아볼 것
    - 익명 파이프
        - 프로세스 간에 FIFO 방식으로 읽히는 임시 공간 파이프를 기반으로 데이터 주고 받음
    
    - 명명된 파이프
        - 파이프 서버와 하나 이상의 파이프 클라이언트 간의 통신을 위한 명명된 단방향 또는 양방향 파이프를 말함
    
    - 메시지 큐
        - 큐 데이터 구조 형태 관리
        - 커널의 전역변수 형태 등 커널에서 전역적으로 관리됨
    

### 3.3.6 스레드와 멀티스레딩

- 스레드
    - 프로세스의 실행 가능한 가장 작은 단위
- 멀티스레딩
    - 프로세스 내 작업을 여러 개의 스레드, 멀티스레드로 처리하는 기법
    - 스레드끼리 자원 공유 → 효율성이 높음
    - 동시성
    - 서로 영향 → 문제도 영향

### 3.3.7 공유 자원과 임계 영역

- 공유 자원
    - 시스템 안에서 각 프로세스 스레드가 함께 접근 가능한 영역
        - 경쟁 상태 : 동시에 접근 시도
- 임계 영역
    - 둘 이상의 프로세스, 스레드가 공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 코드 영역
    - 뮤텍스
        - lock()을 통해 공유자원을 잠금설정
    - 세마포어
        - 일반화된 뮤텍스
        - 간단한 정수값과 두 가지 함수 및 signal로 공유 자원에 대한 접근 처리
    - 바이너리 세마포어
        - 0과 1 두 가지 값만 가질 수 있는 것
        - 구현의 유사성
    - 카운팅 세마포어
    
- 모니터
    - 둘 이상의 스레드나 프로세스가 공유 자원에 안전하게 접근할 수 있도록 공유 자원을 숨기고 해당 접근에 대해 인터페이스만 제공

### 3.3.8 교착 상태

- 두 개 이상의 프로세스 들이 서로가 가진 자원을 기다리며 중단된 상태
    - 상호 배제
    - 점유 대기
    - 비선점
    - 환형 대기

---

## 3.4 CPU 스케줄링 알고리즘

- CPU 스케줄링 알고리즘
    - 프로세스에서 해야 하는 일을 스레드에 CPU단위로 할당(CPU스케줄러)
    - 주어진 시간에 많은 일 / 준비 큐에 있는 프로세스는 적게 / 응답 시간은 짧게

### 3.4.1 비선점형 방식

- FCFS
    - 가장 먼저 온 것을 가장 먼저 처리하는 알고리즘
- SJF
    - 실행 시간이 가장 짧은 프로세스를 가장 먼저 실행하는 알고리즘

- 우선 순위
    - 기존 SJF 스케줄링의 경우 긴 시간을 가진 프로세스가 실행되지 않는 현상이 있었음.
    - 오래된 작업일 수록 우선순위 높여서 해결

### 3.4.2 선점형

- 라운드 로빈
    - 현대 컴퓨터가 쓰는 스케줄링인 우선순위 스케줄링의 일종
    - 동일한 할당 시간 → 시간안에 끝나지 않으면 다시 준비 큐의 뒤로 가는 알고리즘
    - 할당 시간에 따라 FCFS or 오버헤드
    - 전체 작업ㅂ 시간은 길어지나 평균 응답 시간은 짧아짐
- SRF
    - 중간에 실행 시간이 더 짧은 작업이 들어와도 기존 짧은 작업을 모두 수행하고 그 다음 짧은 작업을 이어나감
    - 수행하던 프로세스 중단 → 짧은 작업 실행 → 해당 프로세스 수행

- 다단계 큐
    - 우선순위에 따른 준비 큐를 여러 개 사용 → 큐마다 라운드 로빈이나 FCFS 등 다른 스케줄링 알고리즘을 적용한 것
    - 큐 간의 프로세스 이동이 안되므로 스케줄링 부담이 적지만 유연성이 떨어지는 특징

---