# 4.1 데이터베이스의 기본

날짜: 2023/09/21
태그: study
세부항목: CS스터디, SSAFY, study

## 4.1 데이터베이스의 기본

- 데이터베이스
    - 일정한 규칙 혹은 규약을 통해 구조화되어 저장되는 데이터의 모음
    - 데이터베이스를 제어, 관리하는 통합 시스템 = DBMS

### 4.1.1 엔터티

- 엔터티 entity
    - 여러 개의 속성을 지닌 명사
    - ex) 회원 = 이름 아이디 주소 전화번호

- 약한 에터티와 강한 엔터티
    - 혼자 존재하지 못할 경우 - 약한
    - 종속적x - 강한

### 4.1.2 릴레이션

- 릴레이션
    - 데이터베이스에서 정보를 구분하여 저장하는 기본 단위
- 테이블과 컬렉션
    - 관계형 데이터베이스
    - NoSQL 데이터베이스
    
    ⇒ 레코드 모음 → 테이블 모음 → 데이터베이스
    

### 4.1.3 속성

- 속성
    - 릴레이션에서 관리하는 구체적이며 고유한 이름을 갖는 정보

### 4.1.4 도메인

- 도메인 domain
    - 릴레이션에 포함된 각각의 속성들이 가질 수 있는 값의 집합

### 4.1.5 필드와 레코드

| 필드 |  |
| --- | --- |
| 레코드 |  |
|  |  |

- 필드 타입
    - 타입을 가짐

- MySQL기준
    - 숫자 타입
        - TINYINT
        - SMALLINT
        - MEDIUMINT
        - INT
        - BIGINT
    - 날짜 타입
        - DATE
        - DATETIME
        - TIMESTAMP
    - 문자 타입
        - CHAR
            - 수를 입력해서 몇 자까지 입력할지 결정
            - 고정
        - VARCHAR
            - 수를 입력해서 몇 자까지 입력할지 결정
            - 가변
        
        - TEXT
            - 큰 문자열 저장 (게시판 본문)
        - BLOB
            - 큰 데이터 저장(이미지, 동영상 등)
            - BUT 일반적으로 서버에 파일을 올ㄹ리고 VARCHAR로 파일에 관한 경로를 올림
        
        문자열 열거
        
        - ENUM
            - 하나만 선택하는 단일 선택만 가능하고 ENUM 리스트에 없는 잘못된 값을 삽입하면 빈문자열이 대신 삽입됨
        - SET
            - 여러개의 데이터 선택 / 비트 단위 연산 가능 / 최대 64개의 요소
        

### 4.1.6 관계

- 관계
    - 테이블 간의 관계를 화살표로 나타냄

- 1:1관계
    - 두 개의 테이블로 나눠 → 구조를 더 이해하기 쉽게 만들어 줌
- 1:N 관계
    - 한 개체가 다른 많은 개체를 포함하는 관계
- N:M 관계
    - 다수 대 다수
    - 1: N, 1:M이라는 관계르 ㄹ갖는 테이블 두 개로 나눠서 설정

### 4.1.7 키

- 키
    - 테이블 간의 관계를 조금 더 명확하게 하고 테이블 자체의 인덱스를 위해 설정된 장치

- 기본키
    - Primary Key
    - 유일성, 최소성 만족
    - 테이블의 데이터 중 고유하게 존재하는 속성
    - 기본키에 해당하는 데이터는 중복 x

- 자연키
    - 중복되지 않는 것을 자연스레 뽑다가 나오는 키 → 자연키
- 인조키
    - 인위적으로 부여하는 키
    - 자연키와는 대조적으로 변하지 않음 → 보통 기본키는 인조키로 설정

- 외래키
    - FK / Foreign Key
    - 다른 테이블의 기본키를 그대로 참조하는 값
    - 외래키는 중복되어도 괜찮음

- 후보키
    - 기본키가 될 수 있는 후보들
- 대체키
    - 후보키가 두 개 이상일 경우 어느 하나를 기본키로 지정하고 남은 후보키
- 수퍼키
    - 슈퍼키는 각 레코드를 유일서을 갖춘 키

---

## 4.2 ERD와 정규화 과정

- ERD
    - Entity Relationship Diagram

### 4.2.1 ERD의 중요성

- 시스템의 요구사항을 기반으로 작성 → DB 구축
- 비정형데이터
    - 비구조화 데이터 → 미리 정의된 데이터 모델이 없거나 미리 정의된 방식으로 정리되지 않은 정보를 말함

### 4.2.3 정규화 과정

- 정규화 과정
    - 릴레이션 간의 잘못된 종속 관계로 인해 DB 이상 현상이 일어나서 이를 해결하거나 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정

- 정규형 원칙
    - 정규형의 원칙이란 같은 의미를 표현하는 릴레이션이지만 좀 더 좋은 구조로 만들어야 하고 자료의 중복성은 감소해야 하고 독립적인 관계는 별개의 릴레이션으로 표현해야 하며 각각의 릴레이션은 독립적인 표현이 가능해야 하는 것을 말함

- 제1정규형
    - 릴레이션의 모든 도메인이 더 이상 분해될 수 없는 원자값만으로 구성되어야
- 제2정규형
    - 릴레이션이 제1정규형이며 부분 함수의 종속성을 제거한 형태를 말함
    - 부분 함수의 종속성 제거란 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것을 말함
    - 릴레이션을 분해할 때 동등한 릴레이션으로 분해해야 하고, 정보 손실이 발생하지 않는 무손실 분해로 분해되어야 한다
- 제3정규형
    - 제2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속을 만족하지 않는 상태를 말함
    - 이행적 함수 종속
        - A→B, B→C일 때 C가 A에 이행적으로 함수 종속이 되었다고 함
- 보이스/코드 정규형
    - 제3정규형 → 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태

---

## 4.3 트랜잭션과 무결성

### 4.3.1 트랜잭션

- 트랜잭션
    - 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위
    - 데이터베이스에 접근하는 방법 = 쿼리 → 여러 개의 쿼리를 하나로 묶는 단위

- 원자성
    - all or nothing
    - 모두 수행되었거나 되지 않았거나를 보장하는 특징
    - 트랜잭션 단위로 여러 로직들을 묶을 때 외부 API를 호출하는 것이 있으면 안됨
    
    - 커밋과 롤백
        - 커밋
            
            : 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어
            
            - 트랜잭션 단위로 수행되며 변경된 내용이 모두 영구적으로 저장되는 것
        - 롤백
            
            : 트랜잭션으로 처리한 하나의 묶음 과정을 일어나기 전으로 돌리는 일(취소)
            
    - 트랜잭션 전파
        - 커넥션 단위로 수행 → 커넥션 객체를 넘겨서 수행해야함
        - 따라서 여러 트랜잭션 관련 메서드의 호출을 하나의 트랜잭션에 묶이도록 하는 것
    
- 일관성
    - consistency
    - 허용된 방식으로만 데이터를 변경
    - DB에 기록된 모든 데이터는 여러 가지 조건, 규칙에 따라 유효함을 가져야 함

- 격리성
    - 트랜잭션 수행 시 서로 끼어들지 못하는 것
    - 복수의 병렬 트랜잭션은 서로 격리되어 마치 순차적으로 실행되는 것처럼 작동
    - 데이터베이스는 여러 사용자가 같은 데이터에 접근할 수 있어야
    
    - 격리 수준 (동시성이 낮은 순, 격리성이 높은 순)
        - SERIALIZBLE
            - 트랜잭션을 순차적으로 진행시키는 것
            - 여러 트랜잭션이 동시에 같은 행에 접근할 수 없음
        - REPEATABLE_READ
            - 하나의 트랜잭션이 수정한 행을 다른 트랜잭션이 수정할 수 없도록 막아주지만 새로운 행을 추가하는 것을 막지 않음
        - READ_COMMITTED
            - 가장 많이 사용되는 격리 수준
        - READ_UNCOMMITTED
            - 가장 낮은 격리 수준 → 가장 빠름
            - 데이터 무결성을 위해 되도록이면 사용하지 않는 것이 이상적
    - 격리 수준에 따라 발생하는 현상
        - 팬텀 리드
            
            : 한 트랜잭션 내에서 동일한 쿼리를 보냈을 때 해당 조회 결과가 다른 경우
            
        - 반복 가능하지 않은 조회
            - 한 트랜잭션 내의 같은 행에 두 번 이상 조회가 발생하였는데 → 그 값이 다른 경우
        - 더티 리드 dirty read
            - 반복 가능하지 않은 조회와 유사 → 한 트랜잭션이 실행 중일 때 다른 트랜잭션에 의해 수정됨 but 아직 커밋되지 않은 데이터를 읽을 수 있을 때 발생
    
- 지속성
    - 성공적으로 수행된 트랜잭션은 영원히 반영되어야 한다
    - 체크섬
        - 중복 검사의 한 형태 → 오류 정정을 통해 송신되 자료의 무결성을 보호하는 단순한 방법
    - 저널링
        - 파일 시스템 또는 데이터베이스 시스템에 변경 사항을 반영하기 전에 로깅하는 것, 트랜잭션 등 변경 사항에 대한 로그를 남기는 것

### 4.3.2 무결성

- 무결성
    - 데이터의 정확성, 일관성, 유효성을 유지하는 것

- 종류
    - 기체 무결성
    - 참조 무결성
    - 고유 무결성
    - NULL 무결성